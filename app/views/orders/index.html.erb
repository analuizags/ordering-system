<p id="notice"><%= notice %></p>

<h1>Listing Orders</h1>
<h3>
  Hello <%= current_user.restaurant.name if user_signed_in? %> <br>
  Turno aberto: 
  <% if has_open_work_shift? %>
    <%= current_work_shift.name %>
  <% else %>
    <%= 'none' %>
  <% end %>
</h3>

<%= form_tag orders_path, method: :get do %>
  <table>
    <thead>
      <tr style="text-align:left">
        <th>Work Shift:</th>
        <th>Table:</th>
        <th>Product:</th>
        <th>Status:</th>
        <th colspan="2">Period:</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td><%= select_tag(:work_shift, options_for_select(@domains[:work_shifts], params[:work_shift]), { prompt: 'Select an option' } ) %></td>
        <td><%= select_tag(:table, options_for_select(@domains[:tables], params[:table]), { prompt: 'Select an option' } ) %></td>
        <td><%= select_tag(:product_id, options_for_select(@domains[:products], params[:product_id]), { prompt: 'Select an option' }) %></td>
        <td><%= select_tag(:status, options_for_select(@domains[:statuses]), { prompt: 'Select an option' }) %></td>
        <td>
          <%= date_field_tag(:after, params[:after] ? params[:after] : Date.today-30.days, { class:"mask-date" }) %>
          &nbsp;-&nbsp;
          <%= date_field_tag(:before, params[:before] ? params[:before] : Date.today, { class:"mask-date" }) %>
        </td>
        <td><%= submit_tag("Pesquisar", class:"actions") %></td>
      </tr>
    </tbody>
  </table>
<% end %> <br>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Table</th>
      <th>Status</th>
      <th>Work Shift</th>
      <th colspan="4"></th>
    </tr>
  </thead>

  <tbody>
    <% @orders.each do |order| %>
      <tr>
        <td><%= order.id %></td>
        <td><%= order.table %></td>
        <td><%= order.status %></td>
        <td><%= order.work_shift.name %></td>
        <td><%= link_to 'Show', order %></td>
        <td><%= link_to 'Edit', edit_order_path(order) %></td>
        <% if order.status != 'closed' || order.status != 'canceled' %>
            <td>
              <%= link_to 'Close', close_order_path(order), 'original-title': 'Close',
              data: { confirm: 'Are you sure?' } %>
            </td>
            <td>
              <%= link_to 'Cancel', cancel_order_path(order), 'original-title': 'Cancel',
              data: { confirm: 'It cannot be undone. Are you sure?' } %>
            </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Order', new_order_path %><br>
<%= link_to 'Edit User', edit_user_registration_path %><br>
<%= link_to 'Log out', destroy_user_session_path, method: :delete if user_signed_in? %><br>